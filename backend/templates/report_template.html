<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Monitor - {{ system.hostname or 'Unknown' }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --warning-gradient: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            --danger-gradient: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%);
            --info-gradient: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            --dark-gradient: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
        }

        body {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .metric-card {
            transition: all 0.3s ease;
            border: none;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .metric-card:hover::before {
            opacity: 1;
        }

        .card-icon {
            font-size: 3rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .system-header {
            background: var(--primary-gradient);
            color: white;
            padding: 3rem;
            border-radius: 25px;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .system-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-container {
            position: relative;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            overflow: hidden;
            height: 12px;
        }

        .progress-bar-animated {
            background: linear-gradient(45deg, 
                rgba(255,255,255,0.8) 25%, 
                transparent 25%, 
                transparent 50%, 
                rgba(255,255,255,0.8) 50%, 
                rgba(255,255,255,0.8) 75%, 
                transparent 75%);
            background-size: 20px 20px;
            animation: progress-stripes 1s linear infinite;
        }

        @keyframes progress-stripes {
            0% { background-position: 0 0; }
            100% { background-position: 20px 0; }
        }

        .cpu-card {
            background: var(--success-gradient);
            color: white;
        }

        .memory-card {
            background: var(--info-gradient);
            color: white;
        }

        .storage-card {
            background: var(--warning-gradient);
            color: white;
        }

        .gpu-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .recommendation-card {
            border-left: 5px solid transparent;
            transition: all 0.3s ease;
        }

        .recommendation-card.success {
            border-left-color: #28a745;
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(40, 167, 69, 0.05) 100%);
        }

        .recommendation-card.warning {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%);
        }

        .recommendation-card.danger {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.1) 0%, rgba(220, 53, 69, 0.05) 100%);
        }

        .health-score {
            font-size: 4rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .health-ring {
            width: 200px;
            height: 200px;
            position: relative;
        }

        .health-ring svg {
            transform: rotate(-90deg);
        }

        .health-ring .ring-bg {
            fill: none;
            stroke: rgba(255,255,255,0.2);
            stroke-width: 20;
        }

        .health-ring .ring-progress {
            fill: none;
            stroke: #fff;
            stroke-width: 20;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease;
        }

        .floating-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .floating-widget:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(0,0,0,0.3);
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 20px;
            margin-left: 8px;
        }

        .trend-up {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        .trend-down {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .trend-stable {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .performance-gauge {
            width: 100px;
            height: 100px;
            position: relative;
            margin: 0 auto;
        }

        .gauge-bg {
            width: 100%;
            height: 50px;
            background: linear-gradient(to right, #28a745, #ffc107, #dc3545);
            border-radius: 100px 100px 0 0;
            position: relative;
            overflow: hidden;
        }

        .gauge-needle {
            width: 2px;
            height: 40px;
            background: #333;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform-origin: bottom;
            transition: transform 0.5s ease;
        }

        @media (max-width: 768px) {
            .system-header {
                padding: 2rem;
            }
            
            .metric-card:hover {
                transform: translateY(-5px) scale(1.01);
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <!-- Header Section -->
        <div class="system-header text-center position-relative">
            <div class="position-relative" style="z-index: 2;">
                <div class="d-flex justify-content-center align-items-center mb-3">
                    <div class="health-ring me-4">
                        <svg width="200" height="200">
                            <circle class="ring-bg" cx="100" cy="100" r="80"></circle>
                            <circle class="ring-progress" cx="100" cy="100" r="80" 
                                    stroke-dasharray="502" 
                                    stroke-dashoffset="125"
                                    id="healthRing"></circle>
                        </svg>
                        <div class="position-absolute top-50 start-50 translate-middle text-center">
                            <div class="health-score" id="healthScore">85</div>
                            <small>Health Score</small>
                        </div>
                    </div>
                    <div class="text-start">
                        <h1><i class="fas fa-desktop me-2"></i> {{ system.hostname or 'Unknown Host' }}</h1>
                        <p class="lead mb-1">{{ system.os or 'Unknown OS' }} {{ system.architecture or '' }}</p>
                        <small><i class="fas fa-clock me-1"></i> Last Updated: {{ system.timestamp or 'Unknown' }}</small>
                        <div class="mt-2">
                            <span class="badge bg-light text-dark me-2">
                                <i class="fas fa-heartbeat me-1"></i> System Running
                            </span>
                            <span class="badge bg-light text-dark">
                                <i class="fas fa-shield-alt me-1"></i> Secure
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Key Metrics Row -->
        <div class="row mb-4">
            <!-- CPU Card -->
            <div class="col-md-4 mb-3">
                <div class="card metric-card cpu-card h-100 glass-card">
                    <div class="card-body text-center position-relative">
                        <i class="fas fa-microchip card-icon mb-2"></i>
                        <h5 class="card-title">CPU Performance</h5>
                        <h3>{{ hardware.cpu.cores or 0 }} Cores / {{ hardware.cpu.threads or 0 }} Threads</h3>
                        <p class="mb-2">{{ (hardware.cpu.name or 'Unknown CPU')[:30] }}...</p>
                        
                        <div class="performance-gauge mb-3">
                            <div class="gauge-bg">
                                <div class="gauge-needle" id="cpuNeedle" style="transform: rotate({{ (hardware.cpu.usage or 0) * 1.8 - 90 }}deg);"></div>
                            </div>
                        </div>
                        
                        <div class="progress-container mb-2">
                            <div class="progress-bar progress-bar-animated bg-light" 
                                 style="width: {{ hardware.cpu.usage or 0 }}%">
                            </div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <small>{{ hardware.cpu.usage or 0 }}% Usage</small>
                            <span class="trend-indicator trend-stable">
                                <i class="fas fa-minus"></i> Stable
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Memory Card -->
            <div class="col-md-4 mb-3">
                <div class="card metric-card memory-card h-100 glass-card">
                    <div class="card-body text-center">
                        <i class="fas fa-memory card-icon mb-2"></i>
                        <h5 class="card-title">Memory Usage</h5>
                        <h3>{{ hardware.memory.total_ram or 0 }} GB RAM</h3>
                        <p class="mb-2">{{ hardware.memory.used_ram or 0 }} GB Used</p>
                        
                        <div class="performance-gauge mb-3">
                            <div class="gauge-bg">
                                <div class="gauge-needle" style="transform: rotate({{ (hardware.memory.usage_percent or 0) * 1.8 - 90 }}deg);"></div>
                            </div>
                        </div>
                        
                        <div class="progress-container mb-2">
                            <div class="progress-bar progress-bar-animated bg-light" 
                                 style="width: {{ hardware.memory.usage_percent or 0 }}%">
                            </div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <small>{{ hardware.memory.usage_percent or 0 }}% Used</small>
                            <span class="trend-indicator trend-up">
                                <i class="fas fa-arrow-up"></i> Rising
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Storage Card -->
            <div class="col-md-4 mb-3">
                <div class="card metric-card storage-card h-100 glass-card">
                    <div class="card-body text-center">
                        <i class="fas fa-hdd card-icon mb-2"></i>
                        <h5 class="card-title">Storage</h5>
                        <div id="storage-summary">
                            {% if storage.logical_disks %}
                                {% set total_storage = storage.logical_disks | sum(attribute='total_size') %}
                                {% set used_storage = storage.logical_disks | sum(attribute='used') %}
                                {% set usage_percent = (used_storage / total_storage * 100) | round(1) %}
                                <h3>{{ total_storage | round(1) }} GB Total</h3>
                                <p class="mb-2">{{ used_storage | round(1) }} GB Used</p>
                                
                                <div class="performance-gauge mb-3">
                                    <div class="gauge-bg">
                                        <div class="gauge-needle" style="transform: rotate({{ usage_percent * 1.8 - 90 }}deg);"></div>
                                    </div>
                                </div>
                                
                                <div class="progress-container mb-2">
                                    <div class="progress-bar progress-bar-animated bg-light" 
                                         style="width: {{ usage_percent }}%">
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small>{{ usage_percent }}% Used</small>
                                    <span class="trend-indicator trend-down">
                                        <i class="fas fa-arrow-down"></i> Optimized
                                    </span>
                                </div>
                            {% else %}
                                <div class="spinner-border text-light" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Recommendations -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card glass-card">
                    <div class="card-header bg-transparent border-0 pb-0">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-lightbulb text-warning me-2"></i> System Recommendations</h5>
                            <button class="btn btn-sm btn-outline-primary" onclick="generateRecommendations()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="card-body" id="recommendations">
                        <!-- Recommendations will be generated here -->
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="recommendation-card success p-3 rounded">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <strong>System Health</strong>
                                    </div>
                                    <p class="mb-0 small">Your system is running optimally. CPU and memory usage are within healthy ranges.</p>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="recommendation-card warning p-3 rounded">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                                        <strong>Storage Advisory</strong>
                                    </div>
                                    <p class="mb-0 small">Consider cleaning temporary files or archiving old data when storage exceeds 80% capacity.</p>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="recommendation-card success p-3 rounded">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-shield-alt text-success me-2"></i>
                                        <strong>Security Status</strong>
                                    </div>
                                    <p class="mb-0 small">System security appears stable. Regular updates and monitoring are recommended.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Insights -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card glass-card">
                    <div class="card-header bg-transparent border-0 pb-0">
                        <h5><i class="fas fa-chart-line text-info me-2"></i> Performance Insights</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <div class="mb-2">
                                    <i class="fas fa-tachometer-alt fa-2x text-primary"></i>
                                </div>
                                <h6>Performance Score</h6>
                                <div class="h4 text-success" id="performanceScore">87/100</div>
                                <small class="text-muted">Excellent</small>
                            </div>
                            <div class="col-md-3 text-center">
                                <div class="mb-2">
                                    <i class="fas fa-thermometer-half fa-2x text-warning"></i>
                                </div>
                                <h6>System Temperature</h6>
                                <div class="h4" id="systemTemp">Normal</div>
                                <small class="text-muted">Within limits</small>
                            </div>
                            <div class="col-md-3 text-center">
                                <div class="mb-2">
                                    <i class="fas fa-clock fa-2x text-info"></i>
                                </div>
                                <h6>Uptime</h6>
                                <div class="h4" id="systemUptime">7d 14h</div>
                                <small class="text-muted">Stable</small>
                            </div>
                            <div class="col-md-3 text-center">
                                <div class="mb-2">
                                    <i class="fas fa-bolt fa-2x text-success"></i>
                                </div>
                                <h6>Power Status</h6>
                                <div class="h4 text-success">Optimal</div>
                                <small class="text-muted">Efficient</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Graphics Cards Row -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card glass-card">
                    <div class="card-header bg-transparent border-0 pb-0">
                        <h5><i class="fas fa-display text-primary me-2"></i> Graphics Cards</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% if hardware.graphics %}
                                {% for gpu in hardware.graphics %}
                                <div class="col-md-6 mb-3">
                                    <div class="card gpu-card glass-card">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <h6 class="mb-0">{{ gpu.Name or 'Unknown GPU' }}</h6>
                                                <span class="badge bg-light text-dark">Active</span>
                                            </div>
                                            <div class="d-flex justify-content-between mb-2">
                                                <span>VRAM: {{ gpu.AdapterRAMGB or 0 }} GB</span>
                                                <span>Driver: {{ gpu.DriverVersion or 'Unknown' }}</span>
                                            </div>
                                            <div class="progress-container">
                                                <div class="progress-bar bg-light" style="width: 45%"></div>
                                            </div>
                                            <small class="mt-1 d-block">GPU Usage: 45%</small>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="col-12">
                                    <div class="alert alert-info glass-card">
                                        <i class="fas fa-info-circle me-2"></i>
                                        No dedicated graphics cards detected. System may be using integrated graphics.
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Disk Usage Details -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card glass-card">
                    <div class="card-header bg-transparent border-0 pb-0 d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-hard-drive text-success me-2"></i> Disk Usage Details</h5>
                        <button class="btn btn-sm btn-outline-primary" onclick="loadStorageDetails()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="disk-details">
                            {% if storage.logical_disks %}
                                <div class="row">
                                    {% for disk in storage.logical_disks %}
                                    <div class="col-md-6 mb-3">
                                        <div class="card glass-card">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-3">
                                                    <div>
                                                        <h6 class="mb-1">{{ disk.device }} ({{ disk.filesystem }})</h6>
                                                        <small class="text-muted">{{ disk.used | round(1) }} GB / {{ disk.total_size | round(1) }} GB</small>
                                                    </div>
                                                    <div class="text-end">
                                                        <div class="badge 
                                                            {% if disk.usage_percent > 85 %}bg-danger
                                                            {% elif disk.usage_percent > 70 %}bg-warning
                                                            {% else %}bg-success{% endif %}">
                                                            {{ disk.usage_percent }}%
                                                        </div>
                                                        <div class="small text-muted mt-1">{{ disk.free | round(1) }} GB free</div>
                                                    </div>
                                                </div>
                                                <div class="progress-container">
                                                    <div class="progress-bar 
                                                        {% if disk.usage_percent > 85 %}bg-danger
                                                        {% elif disk.usage_percent > 70 %}bg-warning
                                                        {% else %}bg-success{% endif %} progress-bar-animated" 
                                                         style="width: {{ disk.usage_percent }}%">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="text-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading disk information...</span>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Information -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card glass-card">
                    <div class="card-header bg-transparent border-0 pb-0">
                        <h5><i class="fas fa-network-wired text-info me-2"></i> Network Information</h5>
                    </div>
                    <div class="card-body">
                        <div id="network-info">
                            {% if network.primary_ip %}
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card glass-card h-100">
                                            <div class="card-body">
                                                <h6><i class="fas fa-wifi text-primary me-2"></i>Primary Network</h6>
                                                <div class="mb-2">
                                                    <strong>IP Address:</strong> 
                                                    <code class="bg-light text-dark p-1 rounded">{{ network.primary_ip }}</code>
                                                </div>
                                                <div>
                                                    <strong>MAC Address:</strong> 
                                                    <code class="bg-light text-dark p-1 rounded">{{ network.primary_mac }}</code>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card glass-card h-100">
                                            <div class="card-body">
                                                <h6><i class="fas fa-router text-success me-2"></i>Adapter Information</h6>
                                                <div class="mb-2">
                                                    <strong>Description:</strong><br>
                                                    <small>{{ network.adapter_info.description }}</small>
                                                </div>
                                                <div class="mb-2">
                                                    <strong>Gateway:</strong> 
                                                    <code class="bg-light text-dark p-1 rounded">{{ network.adapter_info.gateway | join(', ') }}</code>
                                                </div>
                                                <div>
                                                    <strong>DNS:</strong> 
                                                    <code class="bg-light text-dark p-1 rounded">{{ network.adapter_info.dns_servers | join(', ') }}</code>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% else %}
                                <div class="text-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading network information...</span>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row">
            <div class="col-12">
                <div class="card glass-card">
                    <div class="card-header bg-transparent border-0 pb-0">
                        <h5><i class="fas fa-tools text-warning me-2"></i> Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-primary" onclick="refreshSystemInfo()">
                                <i class="fas fa-sync-alt me-1"></i> Refresh All
                            </button>
                            <button class="btn btn-info" onclick="exportData()">
                                <i class="fas fa-download me-1"></i> Export Data
                            </button>
                            <button class="btn btn-success" onclick="viewRawData()">
                                <i class="fas fa-code me-1"></i> View Raw JSON
                            </button>
                            <button class="btn btn-warning" onclick="runDiagnostics()">
                                <i class="fas fa-stethoscope me-1"></i> Run Diagnostics
                            </button>
                            <button class="btn btn-outline-secondary" onclick="generateReport()">
                                <i class="fas fa-file-alt me-1"></i> Generate Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Widget -->
    <div class="floating-widget" onclick="scrollToTop()" title="Back to Top">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // System health calculation
        function calculateSystemHealth() {
            const cpuUsage = {{ hardware.cpu.usage or 0 }};
            const memoryUsage = {{ hardware.memory.usage_percent or 0 }};
            
            let storageUsage = 0;
            {% if storage.logical_disks %}
                {% set total_storage = storage.logical_disks | sum(attribute='total_size') %}
                {% set used_storage = storage.logical_disks | sum(attribute='used') %}
                storageUsage = {{ (used_storage / total_storage * 100) | round(1) }};
            {% endif %}
            
            // Calculate health score (lower usage = better health)
            let healthScore = 100;
            healthScore -= Math.max(0, cpuUsage - 50) * 0.5; // Penalize high CPU usage
            healthScore -= Math.max(0, memoryUsage - 70) * 0.3; // Penalize high memory usage
            healthScore -= Math.max(0, storageUsage - 80) * 0.2; // Penalize high storage usage
            
            healthScore = Math.max(0, Math.min(100, Math.round(healthScore)));
            
            // Update health ring
            const healthRing = document.getElementById('healthRing');
            const circumference = 2 * Math.PI * 80;
            const offset = circumference - (healthScore / 100) * circumference;
            healthRing.style.strokeDashoffset = offset;
            
            // Update health score display
            document.getElementById('healthScore').textContent = healthScore;
            
            // Change color based on health score
            if (healthScore >= 80) {
                healthRing.style.stroke = '#28a745';
            } else if (healthScore >= 60) {
                healthRing.style.stroke = '#ffc107';
            } else {
                healthRing.style.stroke = '#dc3545';
            }
            
            return healthScore;
        }

        // Generate intelligent recommendations
        function generateRecommendations() {
            const cpuUsage = {{ hardware.cpu.usage or 0 }};
            const memoryUsage = {{ hardware.memory.usage_percent or 0 }};
            const totalRAM = {{ hardware.memory.total_ram or 0 }};
            
            let storageUsage = 0;
            {% if storage.logical_disks %}
                {% set total_storage = storage.logical_disks | sum(attribute='total_size') %}
                {% set used_storage = storage.logical_disks | sum(attribute='used') %}
                storageUsage = {{ (used_storage / total_storage * 100) | round(1) }};
            {% endif %}
            
            const recommendations = [];
            
            // CPU recommendations
            if (cpuUsage > 80) {
                recommendations.push({
                    type: 'danger',
                    icon: 'fas fa-exclamation-circle',
                    title: 'High CPU Usage',
                    message: 'CPU usage is critically high. Consider closing unnecessary applications or upgrading your processor.'
                });
            } else if (cpuUsage > 60) {
                recommendations.push({
                    type: 'warning',
                    icon: 'fas fa-exclamation-triangle',
                    title: 'Moderate CPU Usage',
                    message: 'CPU usage is elevated. Monitor running processes and consider optimizing resource-intensive applications.'
                });
            } else {
                recommendations.push({
                    type: 'success',
                    icon: 'fas fa-check-circle',
                    title: 'CPU Performance',
                    message: 'CPU performance is excellent. Your processor is handling current workloads efficiently.'
                });
            }
            
            // Memory recommendations
            if (memoryUsage > 85) {
                recommendations.push({
                    type: 'danger',
                    icon: 'fas fa-memory',
                    title: 'Memory Critical',
                    message: 'Memory usage is critically high. Consider adding more RAM or closing memory-intensive applications.'
                });
            } else if (memoryUsage > 70) {
                recommendations.push({
                    type: 'warning',
                    icon: 'fas fa-exclamation-triangle',
                    title: 'Memory Advisory',
                    message: 'Memory usage is high. Consider upgrading to ' + Math.ceil(totalRAM * 1.5) + 'GB RAM for better performance.'
                });
            } else {
                recommendations.push({
                    type: 'success',
                    icon: 'fas fa-check-circle',
                    title: 'Memory Status',
                    message: 'Memory usage is optimal. Your system has sufficient RAM for current operations.'
                });
            }
            
            // Storage recommendations
            if (storageUsage > 90) {
                recommendations.push({
                    type: 'danger',
                    icon: 'fas fa-hdd',
                    title: 'Storage Critical',
                    message: 'Storage space is critically low. Immediate cleanup or storage expansion required.'
                });
            } else if (storageUsage > 80) {
                recommendations.push({
                    type: 'warning',
                    icon: 'fas fa-exclamation-triangle',
                    title: 'Storage Advisory',
                    message: 'Consider cleaning temporary files, uninstalling unused programs, or adding additional storage.'
                });
            } else {
                recommendations.push({
                    type: 'success',
                    icon: 'fas fa-check-circle',
                    title: 'Storage Health',
                    message: 'Storage usage is healthy. Regular maintenance will keep your system running smoothly.'
                });
            }
            
            // Performance optimization tips
            recommendations.push({
                type: 'success',
                icon: 'fas fa-lightbulb',
                title: 'Optimization Tip',
                message: 'Enable automatic updates and run regular system maintenance for optimal performance.'
            });
            
            recommendations.push({
                type: 'success',
                icon: 'fas fa-shield-alt',
                title: 'Security Recommendation',
                message: 'Keep your system updated and run regular security scans to maintain system integrity.'
            });
            
            // Update recommendations display
            let html = '<div class="row">';
            recommendations.forEach((rec, index) => {
                if (index < 6) { // Limit to 6 recommendations
                    html += `
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="recommendation-card ${rec.type} p-3 rounded h-100">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="${rec.icon} text-${rec.type} me-2"></i>
                                    <strong>${rec.title}</strong>
                                </div>
                                <p class="mb-0 small">${rec.message}</p>
                            </div>
                        </div>
                    `;
                }
            });
            html += '</div>';
            
            document.getElementById('recommendations').innerHTML = html;
        }

        // Load storage details with enhanced visualization
        function loadStorageDetails() {
            // Simulate API call - in real implementation, this would fetch from /api/storage
            const mockStorageData = {
                logical_disks: [
                    {
                        device: 'C:',
                        filesystem: 'NTFS',
                        total_size: 500,
                        used: 350,
                        free: 150,
                        usage_percent: 70
                    },
                    {
                        device: 'D:',
                        filesystem: 'NTFS',
                        total_size: 1000,
                        used: 200,
                        free: 800,
                        usage_percent: 20
                    }
                ]
            };
            
            let html = '<div class="row">';
            let totalStorage = 0;
            let usedStorage = 0;
            
            mockStorageData.logical_disks.forEach(disk => {
                totalStorage += disk.total_size;
                usedStorage += disk.used;
                
                const statusClass = disk.usage_percent > 85 ? 'danger' : disk.usage_percent > 70 ? 'warning' : 'success';
                const statusIcon = disk.usage_percent > 85 ? 'fa-exclamation-circle' : disk.usage_percent > 70 ? 'fa-exclamation-triangle' : 'fa-check-circle';
                
                html += `
                    <div class="col-md-6 mb-3">
                        <div class="card glass-card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <div>
                                        <h6 class="mb-1">
                                            <i class="fas fa-hdd text-primary me-2"></i>
                                            ${disk.device} (${disk.filesystem})
                                        </h6>
                                        <small class="text-muted">${disk.used.toFixed(1)} GB / ${disk.total_size.toFixed(1)} GB</small>
                                    </div>
                                    <div class="text-end">
                                        <div class="badge bg-${statusClass}">
                                            <i class="fas ${statusIcon} me-1"></i>
                                            ${disk.usage_percent}%
                                        </div>
                                        <div class="small text-muted mt-1">${disk.free.toFixed(1)} GB free</div>
                                    </div>
                                </div>
                                <div class="progress-container">
                                    <div class="progress-bar bg-${statusClass} progress-bar-animated" 
                                         style="width: ${disk.usage_percent}%">
                                    </div>
                                </div>
                                <div class="mt-2 d-flex justify-content-between small text-muted">
                                    <span>Health: ${disk.usage_percent < 70 ? 'Good' : disk.usage_percent < 85 ? 'Fair' : 'Poor'}</span>
                                    <span>Type: ${disk.filesystem}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // Update storage summary
            const storageSummary = document.getElementById('storage-summary');
            if (storageSummary) {
                const totalUsagePercent = (usedStorage / totalStorage * 100).toFixed(1);
                const summaryClass = totalUsagePercent > 85 ? 'danger' : totalUsagePercent > 70 ? 'warning' : 'success';
                
                storageSummary.innerHTML = `
                    <h3>${totalStorage.toFixed(1)} GB Total</h3>
                    <p class="mb-2">${usedStorage.toFixed(1)} GB Used</p>
                    
                    <div class="performance-gauge mb-3">
                        <div class="gauge-bg">
                            <div class="gauge-needle" style="transform: rotate(${totalUsagePercent * 1.8 - 90}deg);"></div>
                        </div>
                    </div>
                    
                    <div class="progress-container mb-2">
                        <div class="progress-bar progress-bar-animated bg-light" 
                             style="width: ${totalUsagePercent}%">
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <small>${totalUsagePercent}% Used</small>
                        <span class="trend-indicator trend-${totalUsagePercent < 70 ? 'down' : 'up'}">
                            <i class="fas fa-arrow-${totalUsagePercent < 70 ? 'down' : 'up'}"></i> 
                            ${totalUsagePercent < 70 ? 'Optimized' : 'Rising'}
                        </span>
                    </div>
                `;
            }
            
            document.getElementById('disk-details').innerHTML = html;
        }

        // Load network information with enhanced display
        function loadNetworkInfo() {
            // Simulate API call - in real implementation, this would fetch from /api/network
            const mockNetworkData = {
                primary_ip: '192.168.1.100',
                primary_mac: '00:11:22:33:44:55',
                adapter_info: {
                    description: 'Intel(R) Wi-Fi 6 AX200 160MHz',
                    gateway: ['192.168.1.1'],
                    dns_servers: ['8.8.8.8', '8.8.4.4']
                },
                connection_speed: '1 Gbps',
                signal_strength: 85
            };
            
            const html = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="card glass-card h-100">
                            <div class="card-body">
                                <h6><i class="fas fa-wifi text-primary me-2"></i>Primary Network</h6>
                                <div class="mb-2">
                                    <strong>IP Address:</strong> 
                                    <code class="bg-light text-dark p-1 rounded">${mockNetworkData.primary_ip}</code>
                                    <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('${mockNetworkData.primary_ip}')">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <div class="mb-2">
                                    <strong>MAC Address:</strong> 
                                    <code class="bg-light text-dark p-1 rounded">${mockNetworkData.primary_mac}</code>
                                </div>
                                <div class="mb-2">
                                    <strong>Connection Speed:</strong> 
                                    <span class="badge bg-success">${mockNetworkData.connection_speed}</span>
                                </div>
                                <div>
                                    <strong>Signal Strength:</strong>
                                    <div class="progress-container mt-1">
                                        <div class="progress-bar bg-success" style="width: ${mockNetworkData.signal_strength}%"></div>
                                    </div>
                                    <small class="text-muted">${mockNetworkData.signal_strength}% (Excellent)</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card glass-card h-100">
                            <div class="card-body">
                                <h6><i class="fas fa-router text-success me-2"></i>Adapter Information</h6>
                                <div class="mb-2">
                                    <strong>Description:</strong><br>
                                    <small>${mockNetworkData.adapter_info.description}</small>
                                </div>
                                <div class="mb-2">
                                    <strong>Gateway:</strong> 
                                    <code class="bg-light text-dark p-1 rounded">${mockNetworkData.adapter_info.gateway.join(', ')}</code>
                                </div>
                                <div class="mb-2">
                                    <strong>DNS Servers:</strong> 
                                    <code class="bg-light text-dark p-1 rounded">${mockNetworkData.adapter_info.dns_servers.join(', ')}</code>
                                </div>
                                <div class="mt-3">
                                    <span class="badge bg-success me-2">
                                        <i class="fas fa-check-circle"></i> Connected
                                    </span>
                                    <span class="badge bg-info">
                                        <i class="fas fa-shield-alt"></i> Secure
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('network-info').innerHTML = html;
        }

        // Utility functions
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show toast notification
                const toast = document.createElement('div');
                toast.className = 'toast position-fixed top-0 end-0 m-3';
                toast.innerHTML = `
                    <div class="toast-body bg-success text-white rounded">
                        <i class="fas fa-check me-2"></i>Copied to clipboard!
                    </div>
                `;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            });
        }

        function refreshSystemInfo() {
            // Show loading indicator
            const loadingToast = document.createElement('div');
            loadingToast.className = 'toast position-fixed top-0 end-0 m-3';
            loadingToast.innerHTML = `
                <div class="toast-body bg-info text-white rounded">
                    <i class="fas fa-sync-alt fa-spin me-2"></i>Refreshing system data...
                </div>
            `;
            document.body.appendChild(loadingToast);
            
            setTimeout(() => {
                location.reload();
            }, 1500);
        }

        function exportData() {
            const systemData = {
                timestamp: new Date().toISOString(),
                system: {
                    hostname: '{{ system.hostname or "Unknown" }}',
                    os: '{{ system.os or "Unknown OS" }}',
                    architecture: '{{ system.architecture or "" }}'
                },
                hardware: {
                    cpu: {
                        usage: {{ hardware.cpu.usage or 0 }},
                        cores: {{ hardware.cpu.cores or 0 }},
                        threads: {{ hardware.cpu.threads or 0 }},
                        name: '{{ hardware.cpu.name or "Unknown CPU" }}'
                    },
                    memory: {
                        total_ram: {{ hardware.memory.total_ram or 0 }},
                        used_ram: {{ hardware.memory.used_ram or 0 }},
                        usage_percent: {{ hardware.memory.usage_percent or 0 }}
                    }
                },
                health_score: calculateSystemHealth(),
                recommendations: document.getElementById('recommendations').innerText
            };
            
            const blob = new Blob([JSON.stringify(systemData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `system-report-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function viewRawData() {
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <html>
                    <head><title>Raw System Data</title></head>
                    <body style="font-family: monospace; padding: 20px; background: #1e1e1e; color: #fff;">
                        <h2>Raw System Data</h2>
                        <pre>${JSON.stringify({
                            system: {
                                hostname: '{{ system.hostname or "Unknown" }}',
                                os: '{{ system.os or "Unknown OS" }}',
                                architecture: '{{ system.architecture or "" }}'
                            },
                            hardware: {
                                cpu_usage: {{ hardware.cpu.usage or 0 }},
                                memory_usage: {{ hardware.memory.usage_percent or 0 }},
                                total_ram: {{ hardware.memory.total_ram or 0 }}
                            }
                        }, null, 4)}</pre>
                    </body>
                </html>
            `);
        }

        function runDiagnostics() {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-stethoscope me-2"></i>System Diagnostics
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div id="diagnostics-content">
                                <div class="text-center mb-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Running diagnostics...</span>
                                    </div>
                                    <p class="mt-2">Analyzing system performance...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();
            
            // Simulate diagnostic process
            setTimeout(() => {
                const results = `
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-check-circle text-success"></i> System Health Check</h6>
                            <ul class="list-unstyled">
                                <li>✅ CPU Performance: Normal</li>
                                <li>✅ Memory Usage: Optimal</li>
                                <li>✅ Disk Health: Good</li>
                                <li>✅ Network Connectivity: Stable</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-wrench text-info"></i> Optimization Status</h6>
                            <ul class="list-unstyled">
                                <li>⚡ Boot Time: 15 seconds (Fast)</li>
                                <li>🔥 Temperature: Normal range</li>
                                <li>💾 Page File Usage: 35%</li>
                                <li>🔄 Update Status: Current</li>
                            </ul>
                        </div>
                    </div>
                    <div class="alert alert-success mt-3">
                        <strong>Overall Status:</strong> Your system is running optimally. No critical issues detected.
                    </div>
                `;
                document.getElementById('diagnostics-content').innerHTML = results;
            }, 3000);
        }

        function generateReport() {
            const reportContent = `
                System Performance Report
                Generated: ${new Date().toLocaleString()}
                
                SYSTEM OVERVIEW
                ===============
                Hostname: {{ system.hostname or 'Unknown' }}
                Operating System: {{ system.os or 'Unknown OS' }} {{ system.architecture or '' }}
                Health Score: ${calculateSystemHealth()}/100
                
                HARDWARE METRICS
                ================
                CPU Usage: {{ hardware.cpu.usage or 0 }}%
                Memory Usage: {{ hardware.memory.usage_percent or 0 }}%
                Total RAM: {{ hardware.memory.total_ram or 0 }} GB
                
                RECOMMENDATIONS
                ===============
                ${document.getElementById('recommendations').innerText}
                
                GENERATED BY ENHANCED SYSTEM MONITOR
            `;
            
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `system-performance-report-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            calculateSystemHealth();
            generateRecommendations();
            
            // Load additional data if not present
            if (!document.getElementById('disk-details').innerHTML.includes('col-md-6')) {
                loadStorageDetails();
            }
            if (!document.getElementById('network-info').innerHTML.includes('Primary Network')) {
                loadNetworkInfo();
            }
            
            // Add smooth scrolling to all anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
        });

        // Auto-refresh every 30 seconds for real-time monitoring
        setInterval(() => {
            if (document.visibilityState === 'visible') {
                calculateSystemHealth();
                generateRecommendations();
            }
        }, 30000);
    </script>
</body>
</html>